### 우리은행 본점 현직자 인터뷰

- 우리은행 본점에서 대면으로 현직자 인터뷰를 할 수 있는 기회를 우리팀이 얻게 되었다.
- 저번에 인터뷰한 분과 같은 분이어서 편한 마음으로 갔는데 친절하게 많은 정보를 알려주셔서 방향성을 잡는데 많은 도움이 되었다.
- 은행은 뭔가 개발전문가보다는 개발할 줄 아는 금융인을 원하는 느낌이 약간 있었다.

### Trabean 프로젝트

✨ : 통장 비밀번호 검증 API 작성 완료

- 6자리 숫자로 이루어진 문자열로 비밀번호가 들어왔을 때, 맞게 입력된 비밀번호인지 검증하는 API를 작성하는 것이 과제였다.
- 단순히 비밀번호를 조회하고 비교하는 것은 바로 성공해서 이후 해싱을 통해 비밀번호를 안전하게 관리하려고 했다.
- 먼저, 해싱을 직접 구현하는 것은 성능과 보안에 모두 취약할 것으로 판단해서 Spring Security의 Bcrypto를 활용하기로 했다.
- 여름학기부터 해보고 싶었던 데이터베이스에 해싱해서 저장하기를 드디어 해보게 되었는데 비즈니스 로직이 맞는지 판단하는게 어려웠다.
- 일단 Salt와 Pepper를 모두 적용하고자 했는데 같은 비밀번호도 Salt에 따라 다른 해시값이 나오기에 Salt 사용은 6자리 비밀번호 체계에 필수로 판단.
- Salt의 경우 데이터베이스에 컬럼으로 저장한다고 했는데 이러면 데이터베이스 유출 시 해싱된 비밀번호와 옆에 Salt로 비밀번호 역추적이나 무차별 대입 공격으로 원래 비밀번호를 알아낼 수 있을 것으로 생각되어서 이게 왜 안전한지 이해가 안됐다.
- 학습 후 결론은 서버에 대한 공격은 다중 인증이나 요청 횟수 검증 등 여러 방법으로 방어가 가능한데 오프라인에서 비밀번호 맞추기는 시간만 많으면 충분히 뚫리는 것으로 보였다.(최대 100만번만 해보면 되니까)
- 추가로 Bcrypto는 해싱된 비밀번호에 Salt까지 들어있다고 해서 굳이 컬럼을 만들어 줄 필요는 없었다.
- 해싱된 비밀번호에서 Salt를 추출할 수 있는지는 더 자세히 알아보지 않았는데 서버에 Pepper를 저장하고 Pepper와 비밀번호의 조합을 Bcrypto로 해싱하면 서버와 데이터베이스 모두 뚫리지 않는한 원래 비밀번호를 알아내기는 어려울 것으로 생각돼서 이정도면 충분히 보안을 고려한 것 같다.
- Postman을 통해 API가 잘 동작하는 것까지는 확인

✨ : Spring Security 설정

- 아까 Bcrypto를 사용하기 위해 Spring Security 설정을 해줬다.
- gradle에 의존성 추가하고 Config 파일에서 빈으로 등록하고 사용하면 됐는데 Postman에서 요청하니 401 응답코드가 나왔다.
- 401은 내가 응답하는 코드가 아니어서 찾아보니 시큐리티는 API 엔드포인트에 대해 인증 확인이 기본으로 들어간다고 했다.
- 우리 프로젝트는 게이트웨이에서 인증 처리를 하고 이후 각 서버간에만 통신하니까 일단은 설정을 꺼줬고 프로젝트가 어느정도 진행되면 우리 서버들에서만 인증을 꺼주면 될 것 같다.

✨ : 개인 통장 생성 API 작성 완료

- 기존에 비밀번호를 해싱해서 저장하는 것 말고는 다 구현했는데 위 해싱 알고리즘으로 비밀번호를 해싱해서 저장하는 로직을 추가했다.
- Bcrypto를 활용해서 해싱한 비밀번호가 저장되는 것 공용 DB에서 확인

✨ : 통장 권한 변경 API 작성 중

- 유저와 계좌 식별자로 관계 테이블에서 통장 권한을 업데이트하는 간단한 API였다.
- JPA 개념이 아직 부족해서 변경 감지 방식?으로 업데이트를 해야하는지 JPQL?, native query? 방식으로 업데이트를 해야할지 판단이 어려웠다.
- 일단 ChatGPT의 답변과 추천에서 변경 감지는 엔티티에 setter를 추가하거나 엔티티내에 변경 메서드를 넣는 방식으로 보였는데 엔티티에서 비즈니스 로직을 처리하는 느낌도 들고 쿼리를 날려주는게 더 자연스러워 보여서 JPA 레포지토리에서 업데이트 쿼리를 날리는 방식으로 구현했다.
- 통장 권한이 변경되는 것은 Postman으로 확인했고 정상 입력만 들어온다고 가정해서 따로 처리를 해주지는 않았다.
- 한화 여행통장에 대한 권한 변경을 하면 딸려있는 외화 여행통장의 권한도 전부 동일하게 변경해줘야하는데 이 API만 서희한테 받으면 구현이 끝날거 같다.

😂 : 내일 할 일

- 다른 마이크로 서버와의 API를 좀 더 다듬어서 진행중으로 해놓은 API들을 완료로 바꿀 수 있게 충분히 회의하기
- accounts 테이블에서 user-id 컬럼 제거하고 문제없는지 확인하기
